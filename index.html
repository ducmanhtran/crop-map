<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8">
  <title>B·∫£n ƒë·ªì tr·ªìng tr·ªçt t·ª´ Google Sheets</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <!-- Leaflet -->
  <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
  <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>

  <style>
  /* ===== MENU NGANG ===== */
  #menu {
    background: linear-gradient(90deg, #007bff, #0056b3);
    box-shadow: 0 2px 6px rgba(0,0,0,0.25);
    position: relative;
    z-index: 1000;
    font-family: Arial, sans-serif;
  }
  #menu .menu {
    list-style: none;
    margin: 0;
    padding: 0;
    display: flex;
    justify-content: center;
  }
  #menu .menu > li { position: relative; }
  #menu button {
    background: none;
    border: none;
    padding: 14px 20px;
    font-size: 15px;
    color: #fff;        /* ch·ªØ tr·∫Øng */
    font-weight: 600;   /* ƒë·∫≠m h∆°n cho d·ªÖ nh√¨n */
    cursor: pointer;
    transition: background 0.3s;
    display: flex;
    align-items: center;
    gap: 6px;
  }
  #menu button:hover { background: rgba(0,0,0,0.05); color: #007bff; }
  #menu .submenu {
    display: none;
    position: absolute;
    top: 100%; left: 0;
    background: #fff;
    list-style: none;
    margin: 0;
    padding: 6px 0;
    box-shadow: 0 2px 6px rgba(0,0,0,0.25);
    min-width: 200px;
    border-radius: 4px;
  }
  #menu .submenu li { text-align: left; }
  #menu .submenu button {
    width: 100%;
    text-align: left;
    padding: 10px 14px;
    font-size: 14px;
    color: #333;
    background: none;
    border: none;
  }
  #menu .submenu button:hover {
    background: #f0f0f0;
    color: #007bff;
  }
  #menu .menu > li:hover > .submenu { display: block; }

  /* ===== MENU MOBILE ===== */
  @media (max-width: 768px) {
    #menu .menu {
      display: grid;
      grid-template-columns: 1fr 1fr;
      grid-gap: 4px;
      padding: 4px;
    }
    #menu .menu > li {
      border: 1px solid rgba(0,0,0,0.1);
      border-radius: 6px;
      background: rgba(255,255,255,0.6);
    }
    #menu button {
      width: 100%;
      justify-content: center;
      padding: 16px 10px;
      font-size: 15px;
      text-align: center;
    }
    #menu button i {
      display: block;
      font-size: 20px;
      margin-bottom: 4px;
    }
    #menu .submenu {
      display: none;
      position: static;
      box-shadow: none;
      background: #fff;
      margin-top: 2px;
      border-radius: 4px;
    }
    #menu .submenu button {
      text-align: left;
      padding: 10px 14px;
      font-size: 14px;
      color: #333;
    }
    #menu .submenu button:hover {
      background: #f0f0f0;
      color: #007bff;
    }
    #menu .menu > li.open > .submenu { display: block; }
  }

  /* ===== MAP + FOOTER ===== */
  #map {
    height: calc(100vh - 100px);
    width: 100%;
    margin: 0; padding: 0;
  }
  #footerTitle {
    position: fixed;
    bottom: 0; left: 0;
    width: 100%;
    margin: 0;
    padding: 4px 6px;
    background: rgba(255,255,255,0.85);
    text-align: center;
    font-size: 13px;
    box-shadow: 0 -1px 4px rgba(0,0,0,0.15);
    z-index: 1000;
  }
    /* B·ªè n·ªÅn tr·∫Øng m·ªù c·ªßa nh√£n */
    .leaflet-tooltip {
      background: transparent !important;   /* trong su·ªët */
      border: none !important;              /* b·ªè vi·ªÅn */
      box-shadow: none !important;          /* b·ªè b√≥ng */
      color: #000;                          /* m√†u ch·ªØ (b·∫°n ƒë·ªïi t√πy √Ω) */
      font-weight: 600;                     /* ƒë·∫≠m h∆°n */
      font-size: 14px;                      /* c·ª° ch·ªØ */
      white-space: nowrap;                  /* gi·ªØ ch·ªØ tr√™n 1 d√≤ng n·∫øu v·ª´a */
    }
    
    /* N·∫øu mu·ªën ch·ªØ c√≥ vi·ªÅn ƒëen m·ªèng ƒë·ªÉ d·ªÖ ƒë·ªçc tr√™n n·ªÅn s√°ng */
    .leaflet-tooltip::before,
    .leaflet-tooltip::after {
      display: none !important;
    }
    
    .leaflet-tooltip {
      text-shadow: 1px 1px 2px #fff;  /* vi·ªÅn s√°ng xung quanh ch·ªØ */
    }
    .custom-label {
      font-weight: 600;
      font-size: 13px;
      color: #000;
      text-shadow: 1px 1px 2px #fff; /* vi·ªÅn s√°ng */
    }

  </style>
</head>
<body>
  <!-- MENU -->
  <nav id="menu">
    <ul class="menu">
      <li>
        <button>üå± C√¢y tr·ªìng ‚ñæ</button>
        <ul class="submenu">
          <li><button data-crop="all">üåç T·ªïng th·ªÉ</button></li>
          <li><button data-crop="C·ªè">üå± C·ªè</button></li>
          <li><button data-crop="Ng√¥">üåΩ Ng√¥</button></li>
          <li><button data-crop="S·∫Øn">ü•î S·∫Øn</button></li>
          <li><button data-crop="ƒê·∫•t tr·ªëng">‚¨ú ƒê·∫•t tr·ªëng</button></li>
        </ul>
      </li>
      <li>
        <button>üõ†Ô∏è C√¥ng vi·ªác ‚ñæ</button>
        <ul class="submenu">
          <li><button>üìÖ C√¥ng vi·ªác h√†ng ng√†y</button></li>
          <li><button>üìù L∆∞u √Ω c√¥ng vi·ªác</button></li>
          <li><button>üìä B√°o c√°o tu·∫ßn</button></li>
        </ul>
      </li>
      <li>
        <button>üèóÔ∏è H·∫° t·∫ßng ‚ñæ</button>
        <ul class="submenu">
          <li><button>üíß H·ªá th·ªëng t∆∞·ªõi</button></li>
          <li><button>üöú M√°y m√≥c</button></li>
        </ul>
      </li>
      <li>
        <button>üìú Ph√°p l√Ω ‚ñæ</button>
        <ul class="submenu">
          <li><button>üìñ S·ªï ƒë·ªè</button></li>
        </ul>
      </li>
    </ul>
  </nav>

  <!-- MAP -->
  <div id="map"></div>
  <h2 id="footerTitle">B·∫£n ƒë·ªì tr·ªìng tr·ªçt H√≤a Ph√°t Qu·∫£ng B√¨nh</h2>

  <script>
  window.onload = function() {
    const sheetUrl = "https://docs.google.com/spreadsheets/d/13II_ZFEvrxK2qd0mkIX-0TNPdUH5ac4NFykmjqEPCZM/gviz/tq?tqx=out:json";

    let polygons = [];
    let rowsData = [];

    // Kh·ªüi t·∫°o b·∫£n ƒë·ªì
    const map = L.map('map', {
      center: [17.5089721, 106.4670833],
      zoom: 13,
      zoomControl: false
    });
    L.control.zoom({ position: 'bottomright' }).addTo(map);
    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
      attribution: '&copy; OpenStreetMap contributors'
    }).addTo(map);

    // Nh√£n
    const labelsLayer = L.layerGroup().addTo(map);
    let showLabels = false;

    function drawLabels() {
      labelsLayer.clearLayers();
      if (!showLabels) return;
      rowsData.forEach(row => {
        const name = row.c[0]?.v;
        const area = row.c[1]?.v;
        const coords = JSON.parse(row.c[5]?.v);
        if (!coords || coords.length === 0) return;
        const poly = L.polygon(coords);
        const center = poly.getBounds().getCenter();
        L.marker(center, {
          icon: L.divIcon({
            className: "custom-label",
            html: `<div style="font-size:12px; color:#000; white-space: nowrap; text-align: center;">
                     <div><b>${name}</b></div>
                     <div>${area} ha</div>
                   </div>`
          })
        }).addTo(labelsLayer);

      });
    }

    // N√∫t toggle nh√£n
    const toggleBtn = L.control({position: 'topright'});
    toggleBtn.onAdd = function () {
      const btn = L.DomUtil.create('button', 'toggle-labels-btn');
      btn.innerHTML = "üëÅÔ∏è Hi·ªán nh√£n";
      btn.style.background = "#fff";
      btn.style.border = "1px solid #ccc";
      btn.style.padding = "6px 10px";
      btn.style.cursor = "pointer";
      btn.style.borderRadius = "4px";
      btn.onclick = function() {
        showLabels = !showLabels;
        btn.innerHTML = showLabels ? "üôà ·∫®n nh√£n" : "üëÅÔ∏è Hi·ªán nh√£n";
        drawLabels();
      };
      return btn;
    };
    toggleBtn.addTo(map);

    // V·∫Ω d·ªØ li·ªáu
    function drawData(filterCrop) {
      polygons.forEach(p => map.removeLayer(p));
      polygons = [];
      rowsData.forEach(row => {
        const name = row.c[0]?.v;
        const area = row.c[1]?.v;
        const crop = row.c[2]?.v;
        const stage = row.c[3]?.v;
        const coords = JSON.parse(row.c[5]?.v);
        const harvestDateStr = row.c[4]?.v;
        if (filterCrop && filterCrop !== "all" && crop !== filterCrop) return;
        let color = "gray", fillOpacity = 0.6;
        if (crop === "C·ªè") color = "yellow";
        else if (crop === "S·∫Øn") color = "green";
        else if (crop === "Ng√¥") color = "orange";
        else if (crop === "ƒê·∫•t tr·ªëng") { color = "brown"; fillOpacity = 0.3; }
        const poly = L.polygon(coords, {
          color: "blue", weight: 0.5,
          fillColor: color, fillOpacity: fillOpacity
        }).addTo(map);
        poly.bindPopup(`
          <b>${name}</b><br>
          Di·ªán t√≠ch: ${area} ha<br>
          C√¢y: ${crop}<br>
          Giai ƒëo·∫°n: ${stage}<br>
          Ng√†y thu ho·∫°ch: ${harvestDateStr || "Ch∆∞a c√≥"}
        `);
        polygons.push(poly);
      });
      drawLabels();
    }

    // L·∫•y d·ªØ li·ªáu t·ª´ Google Sheets
    fetch(sheetUrl)
      .then(res => res.text())
      .then(data => {
        const json = JSON.parse(data.substr(47).slice(0, -2));
        rowsData = json.table.rows;
        drawData("all");
      });

    // Ch·ªçn crop
    document.querySelectorAll("[data-crop]").forEach(btn => {
      btn.addEventListener("click", function() {
        const crop = this.getAttribute("data-crop");
        drawData(crop);
      });
    });

    // Mobile menu
    if (window.innerWidth <= 768) {
      document.querySelectorAll("#menu .menu > li > button").forEach(btn => {
        btn.addEventListener("click", function(e) {
          e.preventDefault();
          const li = this.parentElement;
          document.queryS<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8">
  <title>B·∫£n ƒë·ªì tr·ªìng tr·ªçt t·ª´ Google Sheets</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <!-- Leaflet -->
  <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
  <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>

  <style>
  /* ===== MENU NGANG ===== */
  #menu {
    background: linear-gradient(90deg, #007bff, #0056b3);
    box-shadow: 0 2px 6px rgba(0,0,0,0.25);
    position: relative;
    z-index: 1000;
    font-family: Arial, sans-serif;
  }
  #menu .menu {
    list-style: none;
    margin: 0;
    padding: 0;
    display: flex;
    justify-content: center;
  }
  #menu .menu > li { position: relative; }
  #menu button {
    background: none;
    border: none;
    padding: 14px 20px;
    font-size: 15px;
    color: #fff;        /* ch·ªØ tr·∫Øng */
    font-weight: 600;   /* ƒë·∫≠m h∆°n cho d·ªÖ nh√¨n */
    cursor: pointer;
    transition: background 0.3s;
    display: flex;
    align-items: center;
    gap: 6px;
  }
  #menu button:hover { background: rgba(0,0,0,0.05); color: #007bff; }
  #menu .submenu {
    display: none;
    position: absolute;
    top: 100%; left: 0;
    background: #fff;
    list-style: none;
    margin: 0;
    padding: 6px 0;
    box-shadow: 0 2px 6px rgba(0,0,0,0.25);
    min-width: 200px;
    border-radius: 4px;
  }
  #menu .submenu li { text-align: left; }
  #menu .submenu button {
    width: 100%;
    text-align: left;
    padding: 10px 14px;
    font-size: 14px;
    color: #333;
    background: none;
    border: none;
  }
  #menu .submenu button:hover {
    background: #f0f0f0;
    color: #007bff;
  }
  #menu .menu > li:hover > .submenu { display: block; }

  /* ===== MENU MOBILE ===== */
  @media (max-width: 768px) {
    #menu .menu {
      display: grid;
      grid-template-columns: 1fr 1fr;
      grid-gap: 4px;
      padding: 4px;
    }
    #menu .menu > li {
      border: 1px solid rgba(0,0,0,0.1);
      border-radius: 6px;
      background: rgba(255,255,255,0.6);
    }
    #menu button {
      width: 100%;
      justify-content: center;
      padding: 16px 10px;
      font-size: 15px;
      text-align: center;
    }
    #menu button i {
      display: block;
      font-size: 20px;
      margin-bottom: 4px;
    }
    #menu .submenu {
      display: none;
      position: static;
      box-shadow: none;
      background: #fff;
      margin-top: 2px;
      border-radius: 4px;
    }
    #menu .submenu button {
      text-align: left;
      padding: 10px 14px;
      font-size: 14px;
      color: #333;
    }
    #menu .submenu button:hover {
      background: #f0f0f0;
      color: #007bff;
    }
    #menu .menu > li.open > .submenu { display: block; }
  }

  /* ===== MAP + FOOTER ===== */
  #map {
    height: calc(100vh - 100px);
    width: 100%;
    margin: 0; padding: 0;
  }
  #footerTitle {
    position: fixed;
    bottom: 0; left: 0;
    width: 100%;
    margin: 0;
    padding: 4px 6px;
    background: rgba(255,255,255,0.85);
    text-align: center;
    font-size: 13px;
    box-shadow: 0 -1px 4px rgba(0,0,0,0.15);
    z-index: 1000;
  }

  /* ===== LABEL CH·ªÆ TR·∫¶N ===== */
  .custom-label {
    font-weight: 600;
    font-size: 13px;
    color: #000;
    text-align: center;
    white-space: nowrap;
    text-shadow: 1px 1px 2px #fff; /* gi√∫p ch·ªØ d·ªÖ ƒë·ªçc tr√™n n·ªÅn */
  }
  </style>
</head>
<body>
  <!-- MENU -->
  <nav id="menu">
    <ul class="menu">
      <li>
        <button>üå± C√¢y tr·ªìng ‚ñæ</button>
        <ul class="submenu">
          <li><button data-crop="all">üåç T·ªïng th·ªÉ</button></li>
          <li><button data-crop="C·ªè">üå± C·ªè</button></li>
          <li><button data-crop="Ng√¥">üåΩ Ng√¥</button></li>
          <li><button data-crop="S·∫Øn">ü•î S·∫Øn</button></li>
          <li><button data-crop="ƒê·∫•t tr·ªëng">‚¨ú ƒê·∫•t tr·ªëng</button></li>
        </ul>
      </li>
      <li>
        <button>üõ†Ô∏è C√¥ng vi·ªác ‚ñæ</button>
        <ul class="submenu">
          <li><button>üìÖ C√¥ng vi·ªác h√†ng ng√†y</button></li>
          <li><button>üìù L∆∞u √Ω c√¥ng vi·ªác</button></li>
          <li><button>üìä B√°o c√°o tu·∫ßn</button></li>
        </ul>
      </li>
      <li>
        <button>üèóÔ∏è H·∫° t·∫ßng ‚ñæ</button>
        <ul class="submenu">
          <li><button>üíß H·ªá th·ªëng t∆∞·ªõi</button></li>
          <li><button>üöú M√°y m√≥c</button></li>
        </ul>
      </li>
      <li>
        <button>üìú Ph√°p l√Ω ‚ñæ</button>
        <ul class="submenu">
          <li><button>üìñ S·ªï ƒë·ªè</button></li>
        </ul>
      </li>
    </ul>
  </nav>

  <!-- MAP -->
  <div id="map"></div>
  <h2 id="footerTitle">B·∫£n ƒë·ªì tr·ªìng tr·ªçt H√≤a Ph√°t Qu·∫£ng B√¨nh</h2>

  <script>
  window.onload = function() {
    const sheetUrl = "https://docs.google.com/spreadsheets/d/13II_ZFEvrxK2qd0mkIX-0TNPdUH5ac4NFykmjqEPCZM/gviz/tq?tqx=out:json";

    let polygons = [];
    let rowsData = [];

    // Kh·ªüi t·∫°o b·∫£n ƒë·ªì
    const map = L.map('map', {
      center: [17.5089721, 106.4670833],
      zoom: 13,
      zoomControl: false
    });
    L.control.zoom({ position: 'bottomright' }).addTo(map);
    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
      attribution: '&copy; OpenStreetMap contributors'
    }).addTo(map);

    // Nh√£n
    const labelsLayer = L.layerGroup().addTo(map);
    let showLabels = false;

    function drawLabels() {
      labelsLayer.clearLayers();
      if (!showLabels) return;
      rowsData.forEach(row => {
        const name = row.c[0]?.v;
        const area = row.c[1]?.v;
        const coords = JSON.parse(row.c[5]?.v);
        if (!coords || coords.length === 0) return;
        const poly = L.polygon(coords);
        const center = poly.getBounds().getCenter();
        L.marker(center, {
          icon: L.divIcon({
            className: "custom-label",
            html: `<div><b>${name}</b><br>${area} ha</div>`
          })
        }).addTo(labelsLayer);
      });
    }

    // N√∫t toggle nh√£n
    const toggleBtn = L.control({position: 'topright'});
    toggleBtn.onAdd = function () {
      const btn = L.DomUtil.create('button', 'toggle-labels-btn');
      btn.innerHTML = "üëÅÔ∏è Hi·ªán nh√£n";
      btn.style.background = "#fff";
      btn.style.border = "1px solid #ccc";
      btn.style.padding = "6px 10px";
      btn.style.cursor = "pointer";
      btn.style.borderRadius = "4px";
      btn.onclick = function() {
        showLabels = !showLabels;
        btn.innerHTML = showLabels ? "üôà ·∫®n nh√£n" : "üëÅÔ∏è Hi·ªán nh√£n";
        drawLabels();
      };
      return btn;
    };
    toggleBtn.addTo(map);

    // V·∫Ω d·ªØ li·ªáu
    function drawData(filterCrop) {
      polygons.forEach(p => map.removeLayer(p));
      polygons = [];
      rowsData.forEach(row => {
        const name = row.c[0]?.v;
        const area = row.c[1]?.v;
        const crop = row.c[2]?.v;
        const stage = row.c[3]?.v;
        const coords = JSON.parse(row.c[5]?.v);
        const harvestDateStr = row.c[4]?.v;
        if (filterCrop && filterCrop !== "all" && crop !== filterCrop) return;
        let color = "gray", fillOpacity = 0.6;
        if (crop === "C·ªè") color = "yellow";
        else if (crop === "S·∫Øn") color = "green";
        else if (crop === "Ng√¥") color = "orange";
        else if (crop === "ƒê·∫•t tr·ªëng") { color = "brown"; fillOpacity = 0.3; }
        const poly = L.polygon(coords, {
          color: "blue", weight: 0.5,
          fillColor: color, fillOpacity: fillOpacity
        }).addTo(map);
        poly.bindPopup(`
          <b>${name}</b><br>
          Di·ªán t√≠ch: ${area} ha<br>
          C√¢y: ${crop}<br>
          Giai ƒëo·∫°n: ${stage}<br>
          Ng√†y thu ho·∫°ch: ${harvestDateStr || "Ch∆∞a c√≥"}
        `);
        polygons.push(poly);
      });
      drawLabels();
    }

    // L·∫•y d·ªØ li·ªáu t·ª´ Google Sheets
    fetch(sheetUrl)
      .then(res => res.text())
      .then(data => {
        const json = JSON.parse(data.substr(47).slice(0, -2));
        rowsData = json.table.rows;
        drawData("all");
      });

    // Ch·ªçn crop
    document.querySelectorAll("[data-crop]").forEach(btn => {
      btn.addEventListener("click", function() {
        const crop = this.getAttribute("data-crop");
        drawData(crop);
      });
    });

    // Mobile menu
    if (window.innerWidth <= 768) {
      document.querySelectorAll("#menu .menu > li > button").forEach(btn => {
        btn.addEventListener("click", function(e) {
          e.preventDefault();
          const li = this.parentElement;
          document.querySelectorAll("#menu .menu > li").forEach(item => {
            if (item !== li) item.classList.remove("open");
          });
          li.classList.toggle("open");
        });
      });
    }
  };
  </script>
</body>
</html>
electorAll("#menu .menu > li").forEach(item => {
            if (item !== li) item.classList.remove("open");
          });
          li.classList.toggle("open");
        });
      });
    }
  };
  </script>
</body>
</html>







