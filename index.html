<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8">
  <title>Báº£n Ä‘á»“ trá»“ng trá»t tá»« Google Sheets</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <!-- Leaflet -->
  <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
  <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>

  <style>
  /* ===== MENU NGANG ===== */
  #menu {
    background: linear-gradient(90deg, #007bff, #0056b3);
    box-shadow: 0 2px 6px rgba(0,0,0,0.25);
    position: relative;
    z-index: 1000;
    font-family: Arial, sans-serif;
  }
  #menu .menu {
    list-style: none;
    margin: 0;
    padding: 0;
    display: flex;
    justify-content: center;
  }
  #menu .menu > li { position: relative; }
  #menu button {
    background: none;
    border: none;
    padding: 14px 20px;
    font-size: 15px;
    color: #fff;        /* chá»¯ tráº¯ng */
    font-weight: 600;   /* Ä‘áº­m hÆ¡n cho dá»… nhÃ¬n */
    cursor: pointer;
    transition: background 0.3s;
    display: flex;
    align-items: center;
    gap: 6px;
  }
  #menu button:hover { background: rgba(0,0,0,0.05); color: #007bff; }
  #menu .submenu {
    display: none;
    position: absolute;
    top: 100%; left: 0;
    background: #fff;
    list-style: none;
    margin: 0;
    padding: 6px 0;
    box-shadow: 0 2px 6px rgba(0,0,0,0.25);
    min-width: 200px;
    border-radius: 4px;
  }
  #menu .submenu li { text-align: left; }
  #menu .submenu button {
    width: 100%;
    text-align: left;
    padding: 10px 14px;
    font-size: 14px;
    color: #333;
    background: none;
    border: none;
  }
  #menu .submenu button:hover {
    background: #f0f0f0;
    color: #007bff;
  }
  #menu .menu > li:hover > .submenu { display: block; }

  /* ===== MENU MOBILE ===== */
  @media (max-width: 768px) {
    #menu .menu {
      display: grid;
      grid-template-columns: 1fr 1fr;
      grid-gap: 4px;
      padding: 4px;
    }
    #menu .menu > li {
      border: 1px solid rgba(0,0,0,0.1);
      border-radius: 6px;
      background: rgba(255,255,255,0.6);
    }
    #menu button {
      width: 100%;
      justify-content: center;
      padding: 16px 10px;
      font-size: 15px;
      text-align: center;
    }
    #menu button i {
      display: block;
      font-size: 20px;
      margin-bottom: 4px;
    }
    #menu .submenu {
      display: none;
      position: static;
      box-shadow: none;
      background: #fff;
      margin-top: 2px;
      border-radius: 4px;
    }
    #menu .submenu button {
      text-align: left;
      padding: 10px 14px;
      font-size: 14px;
      color: #333;
    }
    #menu .submenu button:hover {
      background: #f0f0f0;
      color: #007bff;
    }
    #menu .menu > li.open > .submenu { display: block; }
  }

  /* ===== MAP + FOOTER ===== */
  #map {
    height: calc(100vh - 100px);
    width: 100%;
    margin: 0; padding: 0;
  }
  #footerTitle {
    position: fixed;
    bottom: 0; left: 0;
    width: 100%;
    margin: 0;
    padding: 4px 6px;
    background: rgba(255,255,255,0.85);
    text-align: center;
    font-size: 13px;
    box-shadow: 0 -1px 4px rgba(0,0,0,0.15);
    z-index: 1000;
  }
    /* Bá» ná»n tráº¯ng má» cá»§a nhÃ£n */
    .leaflet-tooltip {
      background: transparent !important;   /* trong suá»‘t */
      border: none !important;              /* bá» viá»n */
      box-shadow: none !important;          /* bá» bÃ³ng */
      color: #000;                          /* mÃ u chá»¯ (báº¡n Ä‘á»•i tÃ¹y Ã½) */
      font-weight: 600;                     /* Ä‘áº­m hÆ¡n */
      font-size: 14px;                      /* cá»¡ chá»¯ */
      white-space: nowrap;                  /* giá»¯ chá»¯ trÃªn 1 dÃ²ng náº¿u vá»«a */
    }
    
    /* Náº¿u muá»‘n chá»¯ cÃ³ viá»n Ä‘en má»ng Ä‘á»ƒ dá»… Ä‘á»c trÃªn ná»n sÃ¡ng */
    .leaflet-tooltip::before,
    .leaflet-tooltip::after {
      display: none !important;
    }
    
    .leaflet-tooltip {
      text-shadow: 1px 1px 2px #fff;  /* viá»n sÃ¡ng xung quanh chá»¯ */
    }
    .custom-label {
      font-weight: 100;
      font-size: 13px;
      color: #000;
    }

  </style>
</head>
<body>
  <!-- MENU -->
  <nav id="menu">
    <ul class="menu">
      <li>
        <button>ğŸŒ± CÃ¢y trá»“ng â–¾</button>
        <ul class="submenu">
          <li><button data-crop="all">ğŸŒ Tá»•ng thá»ƒ</button></li>
          <li><button data-crop="Cá»">ğŸŒ± Cá»</button></li>
          <li><button data-crop="NgÃ´">ğŸŒ½ NgÃ´</button></li>
          <li><button data-crop="Sáº¯n">ğŸ¥” Sáº¯n</button></li>
          <li><button data-crop="Äáº¥t trá»‘ng">â¬œ Äáº¥t trá»‘ng</button></li>
        </ul>
      </li>
      <li>
        <button>ğŸ› ï¸ CÃ´ng viá»‡c â–¾</button>
        <ul class="submenu">
          <li><button>ğŸ“… CÃ´ng viá»‡c hÃ ng ngÃ y</button></li>
          <li><button>ğŸ“ LÆ°u Ã½ cÃ´ng viá»‡c</button></li>
          <li><button>ğŸ“Š BÃ¡o cÃ¡o tuáº§n</button></li>
        </ul>
      </li>
      <li>
        <button>ğŸ—ï¸ Háº¡ táº§ng â–¾</button>
        <ul class="submenu">
          <li><button>ğŸ’§ Há»‡ thá»‘ng tÆ°á»›i</button></li>
          <li><button>ğŸšœ MÃ¡y mÃ³c</button></li>
        </ul>
      </li>
      <li>
        <button>ğŸ“œ PhÃ¡p lÃ½ â–¾</button>
        <ul class="submenu">
          <li><button>ğŸ“– Sá»• Ä‘á»</button></li>
        </ul>
      </li>
    </ul>
  </nav>

  <!-- MAP -->
  <div id="map"></div>
  <h2 id="footerTitle">Báº£n Ä‘á»“ trá»“ng trá»t HÃ²a PhÃ¡t Quáº£ng BÃ¬nh</h2>

  <script>
  window.onload = function() {
    const sheetUrl = "https://docs.google.com/spreadsheets/d/13II_ZFEvrxK2qd0mkIX-0TNPdUH5ac4NFykmjqEPCZM/gviz/tq?tqx=out:json";

    let polygons = [];
    let rowsData = [];

    // Khá»Ÿi táº¡o báº£n Ä‘á»“
    const map = L.map('map', {
      center: [17.5089721, 106.4670833],
      zoom: 13,
      zoomControl: false
    });
    L.control.zoom({ position: 'bottomright' }).addTo(map);
    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
      attribution: '&copy; OpenStreetMap contributors'
    }).addTo(map);

    // NhÃ£n
    const labelsLayer = L.layerGroup().addTo(map);
    let showLabels = false;

    function drawLabels() {
      labelsLayer.clearLayers();
      if (!showLabels) return;
      rowsData.forEach(row => {
        const name = row.c[0]?.v;
        const area = row.c[1]?.v;
        const coords = JSON.parse(row.c[5]?.v);
        if (!coords || coords.length === 0) return;
        const poly = L.polygon(coords);
        const center = poly.getBounds().getCenter();
        L.marker(center, {
          icon: L.divIcon({
            className: "custom-label",
            html: `<div style="font-size:12px; color:#000; white-space: nowrap; text-align: center;">
                     <div><b>${name}</b></div>
                     <div>${area} ha</div>
                   </div>`
          })
        }).addTo(labelsLayer);

      });
    }

    // NÃºt toggle nhÃ£n
    const toggleBtn = L.control({position: 'topright'});
    toggleBtn.onAdd = function () {
      const btn = L.DomUtil.create('button', 'toggle-labels-btn');
      btn.innerHTML = "ğŸ‘ï¸ Hiá»‡n nhÃ£n";
      btn.style.background = "#fff";
      btn.style.border = "1px solid #ccc";
      btn.style.padding = "6px 10px";
      btn.style.cursor = "pointer";
      btn.style.borderRadius = "4px";
      btn.onclick = function() {
        showLabels = !showLabels;
        btn.innerHTML = showLabels ? "ğŸ™ˆ áº¨n nhÃ£n" : "ğŸ‘ï¸ Hiá»‡n nhÃ£n";
        drawLabels();
      };
      return btn;
    };
    toggleBtn.addTo(map);

    // Váº½ dá»¯ liá»‡u
    function drawData(filterCrop) {
    // XÃ³a cÃ¡c polygon cÅ©
    polygons.forEach(p => map.removeLayer(p));
    polygons = [];
  
    rowsData.forEach(row => {
      const name = row.c[0]?.v;
      const area = row.c[1]?.v;
      const crop = row.c[2]?.v;
      const stage = row.c[3]?.v;
      const coords = JSON.parse(row.c[5]?.v);
      const harvestDateStr = row.c[4]?.v; // ngÃ y thu hoáº¡ch thá»±c táº¿ (dd/mm/yyyy)
  
      if (!coords) return;
      if (filterCrop && filterCrop !== "all" && crop !== filterCrop) return;
  
      let color = "blue";        // viá»n máº·c Ä‘á»‹nh
      let fillColor = "gray";    // mÃ u máº·c Ä‘á»‹nh
      let fillOpacity = 0.6;     // Ä‘á»™ má» máº·c Ä‘á»‹nh
  
      // ======= Xá»­ lÃ½ theo loáº¡i cÃ¢y =======
      if (crop === "Cá»") {
        fillColor = "yellow";
        fillOpacity = 0.4; // máº·c Ä‘á»‹nh vÃ ng nháº¡t
  
        if (harvestDateStr) {
          // parse dd/mm/yyyy -> Date
          const parts = harvestDateStr.split("/");
          if (parts.length === 3) {
            const harvestDate = new Date(parts[2], parts[1] - 1, parts[0]);
            const today = new Date();
  
            // sá»‘ ngÃ y ká»ƒ tá»« láº§n thu hoáº¡ch gáº§n nháº¥t
            const diffDays = (today - harvestDate) / (1000 * 60 * 60 * 24);
  
            if (!isNaN(diffDays)) {
              // opacity tá»· lá»‡ theo sá»‘ ngÃ y / 90 (min 0.1, max 1)
              let ratio = diffDays / 90;
              fillOpacity = Math.max(0.1, Math.min(ratio, 1));
  
              // náº¿u Ä‘Ã£ Ä‘á»§ 90 ngÃ y mÃ  chÆ°a thu hoáº¡ch láº¡i => viá»n Ä‘á»
              if (diffDays >= 90) {
                color = "red";
                fillOpacity = 1;
              }
            }
          }
        }
      } else if (crop === "Sáº¯n") {
        fillColor = "green";
      } else if (crop === "NgÃ´") {
        fillColor = "orange";
      } else if (crop === "Äáº¥t trá»‘ng") {
        fillColor = "brown";
        fillOpacity = 0.3;
      }
  
      // ======= Váº½ polygon =======
      const poly = L.polygon(coords, {
        color: color,
        weight: 1,
        fillColor: fillColor,
        fillOpacity: fillOpacity
      }).addTo(map);
  
      // popup thÃ´ng tin
      let popupContent = `
        <b>${name}</b><br>
        Diá»‡n tÃ­ch: ${area} ha<br>
        CÃ¢y: ${crop}<br>
        Giai Ä‘oáº¡n: ${stage}<br>
        NgÃ y thu hoáº¡ch: ${harvestDateStr || "ChÆ°a cÃ³"}
      `;
  
      // náº¿u lÃ  cá» thÃ¬ thÃªm dÃ²ng sá»‘ ngÃ y Ä‘Ã£ qua
      if (crop === "Cá»" && harvestDateStr) {
        const parts = harvestDateStr.split("/");
        if (parts.length === 3) {
          const harvestDate = new Date(parts[2], parts[1] - 1, parts[0]);
          const today = new Date();
          const diffDays = Math.floor((today - harvestDate) / (1000 * 60 * 60 * 24));
          if (!isNaN(diffDays)) {
            popupContent += `<br>ÄÃ£ qua: ${diffDays} ngÃ y`;
          }
        }
      }
  
      poly.bindPopup(popupContent);
  
      polygons.push(poly);
    });
  
    // váº½ láº¡i nhÃ£n náº¿u Ä‘ang báº­t
    drawLabels();
  }


    // Láº¥y dá»¯ liá»‡u tá»« Google Sheets
    fetch(sheetUrl)
      .then(res => res.text())
      .then(data => {
        const json = JSON.parse(data.substr(47).slice(0, -2));
        rowsData = json.table.rows;
        drawData("all");
      });

    // Chá»n crop
    document.querySelectorAll("[data-crop]").forEach(btn => {
      btn.addEventListener("click", function() {
        const crop = this.getAttribute("data-crop");
        drawData(crop);
      });
    });

    // Mobile menu
    if (window.innerWidth <= 768) {
      document.querySelectorAll("#menu .menu > li > button").forEach(btn => {
        btn.addEventListener("click", function(e) {
          e.preventDefault();
          const li = this.parentElement;
          document.queryS<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8">
  <title>Báº£n Ä‘á»“ trá»“ng trá»t tá»« Google Sheets</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <!-- Leaflet -->
  <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
  <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>

  <style>
  /* ===== MENU NGANG ===== */
  #menu {
    background: linear-gradient(90deg, #007bff, #0056b3);
    box-shadow: 0 2px 6px rgba(0,0,0,0.25);
    position: relative;
    z-index: 1000;
    font-family: Arial, sans-serif;
  }
  #menu .menu {
    list-style: none;
    margin: 0;
    padding: 0;
    display: flex;
    justify-content: center;
  }
  #menu .menu > li { position: relative; }
  #menu button {
    background: none;
    border: none;
    padding: 14px 20px;
    font-size: 15px;
    color: #fff;        /* chá»¯ tráº¯ng */
    font-weight: 600;   /* Ä‘áº­m hÆ¡n cho dá»… nhÃ¬n */
    cursor: pointer;
    transition: background 0.3s;
    display: flex;
    align-items: center;
    gap: 6px;
  }
  #menu button:hover { background: rgba(0,0,0,0.05); color: #007bff; }
  #menu .submenu {
    display: none;
    position: absolute;
    top: 100%; left: 0;
    background: #fff;
    list-style: none;
    margin: 0;
    padding: 6px 0;
    box-shadow: 0 2px 6px rgba(0,0,0,0.25);
    min-width: 200px;
    border-radius: 4px;
  }
  #menu .submenu li { text-align: left; }
  #menu .submenu button {
    width: 100%;
    text-align: left;
    padding: 10px 14px;
    font-size: 14px;
    color: #333;
    background: none;
    border: none;
  }
  #menu .submenu button:hover {
    background: #f0f0f0;
    color: #007bff;
  }
  #menu .menu > li:hover > .submenu { display: block; }

  /* ===== MENU MOBILE ===== */
  @media (max-width: 768px) {
    #menu .menu {
      display: grid;
      grid-template-columns: 1fr 1fr;
      grid-gap: 4px;
      padding: 4px;
    }
    #menu .menu > li {
      border: 1px solid rgba(0,0,0,0.1);
      border-radius: 6px;
      background: rgba(255,255,255,0.6);
    }
    #menu button {
      width: 100%;
      justify-content: center;
      padding: 16px 10px;
      font-size: 15px;
      text-align: center;
    }
    #menu button i {
      display: block;
      font-size: 20px;
      margin-bottom: 4px;
    }
    #menu .submenu {
      display: none;
      position: static;
      box-shadow: none;
      background: #fff;
      margin-top: 2px;
      border-radius: 4px;
    }
    #menu .submenu button {
      text-align: left;
      padding: 10px 14px;
      font-size: 14px;
      color: #333;
    }
    #menu .submenu button:hover {
      background: #f0f0f0;
      color: #007bff;
    }
    #menu .menu > li.open > .submenu { display: block; }
  }

  /* ===== MAP + FOOTER ===== */
  #map {
    height: calc(100vh - 100px);
    width: 100%;
    margin: 0; padding: 0;
  }
  #footerTitle {
    position: fixed;
    bottom: 0; left: 0;
    width: 100%;
    margin: 0;
    padding: 4px 6px;
    background: rgba(255,255,255,0.85);
    text-align: center;
    font-size: 13px;
    box-shadow: 0 -1px 4px rgba(0,0,0,0.15);
    z-index: 1000;
  }

  /* ===== LABEL CHá»® TRáº¦N ===== */
  .custom-label {
    font-weight: 600;
    font-size: 13px;
    color: #000;
    text-align: center;
    white-space: nowrap;
    text-shadow: 1px 1px 2px #fff; /* giÃºp chá»¯ dá»… Ä‘á»c trÃªn ná»n */
  }
  </style>
</head>
<body>
  <!-- MENU -->
  <nav id="menu">
    <ul class="menu">
      <li>
        <button>ğŸŒ± CÃ¢y trá»“ng â–¾</button>
        <ul class="submenu">
          <li><button data-crop="all">ğŸŒ Tá»•ng thá»ƒ</button></li>
          <li><button data-crop="Cá»">ğŸŒ± Cá»</button></li>
          <li><button data-crop="NgÃ´">ğŸŒ½ NgÃ´</button></li>
          <li><button data-crop="Sáº¯n">ğŸ¥” Sáº¯n</button></li>
          <li><button data-crop="Äáº¥t trá»‘ng">â¬œ Äáº¥t trá»‘ng</button></li>
        </ul>
      </li>
      <li>
        <button>ğŸ› ï¸ CÃ´ng viá»‡c â–¾</button>
        <ul class="submenu">
          <li><button>ğŸ“… CÃ´ng viá»‡c hÃ ng ngÃ y</button></li>
          <li><button>ğŸ“ LÆ°u Ã½ cÃ´ng viá»‡c</button></li>
          <li><button>ğŸ“Š BÃ¡o cÃ¡o tuáº§n</button></li>
        </ul>
      </li>
      <li>
        <button>ğŸ—ï¸ Háº¡ táº§ng â–¾</button>
        <ul class="submenu">
          <li><button>ğŸ’§ Há»‡ thá»‘ng tÆ°á»›i</button></li>
          <li><button>ğŸšœ MÃ¡y mÃ³c</button></li>
        </ul>
      </li>
      <li>
        <button>ğŸ“œ PhÃ¡p lÃ½ â–¾</button>
        <ul class="submenu">
          <li><button>ğŸ“– Sá»• Ä‘á»</button></li>
        </ul>
      </li>
    </ul>
  </nav>

  <!-- MAP -->
  <div id="map"></div>
  <h2 id="footerTitle">Báº£n Ä‘á»“ trá»“ng trá»t HÃ²a PhÃ¡t Quáº£ng BÃ¬nh</h2>

  <script>
  window.onload = function() {
    const sheetUrl = "https://docs.google.com/spreadsheets/d/13II_ZFEvrxK2qd0mkIX-0TNPdUH5ac4NFykmjqEPCZM/gviz/tq?tqx=out:json";

    let polygons = [];
    let rowsData = [];

    // Khá»Ÿi táº¡o báº£n Ä‘á»“
    const map = L.map('map', {
      center: [17.5089721, 106.4670833],
      zoom: 13,
      zoomControl: false
    });
    L.control.zoom({ position: 'bottomright' }).addTo(map);
    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
      attribution: '&copy; OpenStreetMap contributors'
    }).addTo(map);

    // NhÃ£n
    const labelsLayer = L.layerGroup().addTo(map);
    let showLabels = false;

    function drawLabels() {
      labelsLayer.clearLayers();
      if (!showLabels) return;
      rowsData.forEach(row => {
        const name = row.c[0]?.v;
        const area = row.c[1]?.v;
        const coords = JSON.parse(row.c[5]?.v);
        if (!coords || coords.length === 0) return;
        const poly = L.polygon(coords);
        const center = poly.getBounds().getCenter();
        L.marker(center, {
          icon: L.divIcon({
            className: "custom-label",
            html: `<div><b>${name}</b><br>${area} ha</div>`
          })
        }).addTo(labelsLayer);
      });
    }

    // NÃºt toggle nhÃ£n
    const toggleBtn = L.control({position: 'topright'});
    toggleBtn.onAdd = function () {
      const btn = L.DomUtil.create('button', 'toggle-labels-btn');
      btn.innerHTML = "ğŸ‘ï¸ Hiá»‡n nhÃ£n";
      btn.style.background = "#fff";
      btn.style.border = "1px solid #ccc";
      btn.style.padding = "6px 10px";
      btn.style.cursor = "pointer";
      btn.style.borderRadius = "4px";
      btn.onclick = function() {
        showLabels = !showLabels;
        btn.innerHTML = showLabels ? "ğŸ™ˆ áº¨n nhÃ£n" : "ğŸ‘ï¸ Hiá»‡n nhÃ£n";
        drawLabels();
      };
      return btn;
    };
    toggleBtn.addTo(map);

    // Váº½ dá»¯ liá»‡u
    // HÃ m parse chuá»—i ngÃ y dd/mm/yyyy thÃ nh Ä‘á»‘i tÆ°á»£ng Date
    function parseDate_ddmmyyyy(str) {
      if (!str) return null;
      const parts = str.split("/");
      if (parts.length !== 3) return null;
      const day = parseInt(parts[0], 10);
      const month = parseInt(parts[1], 10) - 1; // thÃ¡ng JS tá»« 0â€“11
      const year = parseInt(parts[2], 10);
      return new Date(year, month, day);
    }
    
    // HÃ m váº½ dá»¯ liá»‡u tá»« Google Sheets
    function drawData(filterCrop) {
  polygons.forEach(p => map.removeLayer(p));
  polygons = [];

  rowsData.forEach(row => {
    const id = row.c[0]?.v;          // MÃ£ lÃ´
    const area = row.c[1]?.v;        // Diá»‡n tÃ­ch
    const crop = row.c[2]?.v;        // Loáº¡i cÃ¢y
    const stage = row.c[3]?.v;       // Giai Ä‘oáº¡n
    const harvestDateStr = row.c[4]?.v; // NgÃ y thu hoáº¡ch (dd/mm/yyyy)
    const coords = JSON.parse(row.c[5]?.v); // tá»a Ä‘á»™ polygon (mÃ¬nh giáº£ sá»­ lÆ°u JSON trong sheet)

    if (!coords) return;
    if (filterCrop && filterCrop !== "all" && crop !== filterCrop) return;

    let color = "blue";
    let fillColor = "gray";
    let fillOpacity = 0.6;

    // === xá»­ lÃ½ riÃªng cho cá» ===
    if (crop === "Cá»") {
      fillColor = "yellow";
      fillOpacity = 0.4;

      if (harvestDateStr) {
        const harvestDate = parseDate_ddmmyyyy(harvestDateStr);
        const today = new Date();

        if (harvestDate) {
          const diffDays = (today - harvestDate) / (1000 * 60 * 60 * 24);
          if (!isNaN(diffDays)) {
            let ratio = diffDays / 90;
            fillOpacity = Math.max(0.1, Math.min(ratio, 1));
            if (diffDays >= 90) {
              color = "red";
              fillOpacity = 1;
            }
          }
        }
      }
    } else if (crop === "Sáº¯n") {
      fillColor = "green";
    } else if (crop === "NgÃ´") {
      fillColor = "orange";
    } else if (crop === "Äáº¥t trá»‘ng") {
      fillColor = "brown";
      fillOpacity = 0.3;
    }

    const poly = L.polygon(coords, {
      color,
      weight: 1,
      fillColor,
      fillOpacity
    }).addTo(map);

    let popupContent = `
      <b>${id}</b><br>
      Diá»‡n tÃ­ch: ${area} ha<br>
      CÃ¢y: ${crop}<br>
      Giai Ä‘oáº¡n: ${stage}<br>
      NgÃ y thu hoáº¡ch: ${harvestDateStr || "ChÆ°a cÃ³"}
    `;

    poly.bindPopup(popupContent);
    polygons.push(poly);
  });

  drawLabels();
}


    // Chá»n crop
    document.querySelectorAll("[data-crop]").forEach(btn => {
      btn.addEventListener("click", function() {
        const crop = this.getAttribute("data-crop");
        drawData(crop);
      });
    });

    // Mobile menu
    if (window.innerWidth <= 768) {
      document.querySelectorAll("#menu .menu > li > button").forEach(btn => {
        btn.addEventListener("click", function(e) {
          e.preventDefault();
          const li = this.parentElement;
          document.querySelectorAll("#menu .menu > li").forEach(item => {
            if (item !== li) item.classList.remove("open");
          });
          li.classList.toggle("open");
        });
      });
    }
  };
  </script>
</body>
</html>













